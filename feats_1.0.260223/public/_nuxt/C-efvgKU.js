import{_ as H}from"./SmUkFbJe.js";import{e as I,f as Q,$ as U,c as i,a as t,b as p,t as g,F as L,m as T,q as d,r as o,o as c}from"./CedIGCwc.js";const W={class:"grid gap-15 lg:grid-cols-3"},X={class:"table-statistics bg-white border"},Z={class:"table-statistics bg-white border"},ee={class:"text-xl font-semibold mb-3"},te={class:"table-statistics bg-white border"},se={class:"mt-12"},ae={class:"table-statistics bg-white border"},ne={class:"mt-12"},le={class:"bg-white border overflow-x-auto"},oe={class:"table-statistics min-w-full"},re={class:"bg-gray-100"},ie={class:"p-2 font-semibold"},ce={key:0},de={class:"text-gray-600"},ue={key:1,class:"text-gray-400"},me=I({__name:"statistics",setup(ve){const B=d(()=>new Date().getFullYear()),r=o({yearTotals:[],perBike:[],longestPerYear:[],monthlyTotals:[],ridesOver100ByYear:[]}),S=o(null),Y=o(null),k=o(null),x=o(null),b=o({sorting:[]}),m=o({sorting:[]}),f=o({sorting:[]}),y=o({sorting:[{id:"year",desc:!0}]}),K=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"distance",headerLabel:"Distance",enableSorting:!0},{accessorKey:"rides",headerLabel:"Total Rides",enableSorting:!0}],D=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"longest",headerLabel:"Longest Ride",enableSorting:!0}],O=[{accessorKey:"bike",headerLabel:"Bike",enableSorting:!0},{accessorKey:"distance",headerLabel:"Distance",enableSorting:!0},{accessorKey:"rides",headerLabel:"Number",enableSorting:!0}],P=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"count",headerLabel:"Rides > 100km",enableSorting:!0},{accessorKey:"distancesFormatted",headerLabel:"Distances (km)",enableSorting:!1,cell:e=>e.getValue()}];function R(e){b.value=typeof e=="function"?e(b.value):e}function C(e){m.value=typeof e=="function"?e(m.value):e}function F(e){f.value=typeof e=="function"?e(f.value):e}function M(e){y.value=typeof e=="function"?e(y.value):e}const V=d(()=>h(r.value.yearTotals,b.value.sorting)),$=d(()=>h(r.value.longestPerYear,m.value.sorting)),A=d(()=>h(r.value.perBike,f.value.sorting)),J=d(()=>{const e=r.value.ridesOver100ByYear.map(s=>{const l=s.distances||[],a=l.slice(0,15),n=l.length-15;let _=a.join(", ");return n>0&&(_+=` and ${n} more`),{...s,distancesFormatted:_}});return h(e,y.value.sorting)});function h(e,s){if(!s||s.length===0)return e;const l=s[0],a=[...e].sort((n,_)=>{const u=n[l.id],v=_[l.id];return u===v?0:u==null?1:v==null?-1:typeof u=="number"&&typeof v=="number"?u-v:String(u).localeCompare(String(v))});return l.desc?a.reverse():a}const q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],N=d(()=>{const e=new Set(r.value.monthlyTotals.map(s=>s.year));return Array.from(e).sort((s,l)=>l-s)});function w(e,s){const l=String(s).padStart(2,"0");return r.value.monthlyTotals.find(a=>a.year===e&&a.month===l)}function j(e){S.value=S.value===e?null:e}function E(e){Y.value=Y.value===e?null:e}function z(e){k.value=k.value===e?null:e}function G(e){x.value=x.value===e?null:e}return Q(async()=>{const e=await U("/api/stats");r.value=e}),(e,s)=>{const l=H;return c(),i("section",null,[s[5]||(s[5]=t("h1",{class:"text-3xl font-semibold mb-6"},"Statistics",-1)),t("div",W,[t("div",null,[s[0]||(s[0]=t("h2",{class:"text-xl font-semibold mb-3"},"Year Totals",-1)),t("div",X,[p(l,{data:V.value,columns:K,state:b.value,"on-state-change":R,"on-select":(a,n)=>j(n.year),"selected-row-id":S.value},null,8,["data","state","on-select","selected-row-id"])])]),t("div",null,[s[1]||(s[1]=t("h2",{class:"text-xl font-semibold mb-3"},"Longest Ride per Year",-1)),t("div",Z,[p(l,{data:$.value,columns:D,state:m.value,"on-state-change":C,"on-select":(a,n)=>z(n.year),"selected-row-id":k.value},null,8,["data","state","on-select","selected-row-id"])])]),t("div",null,[t("h2",ee,"Distance and Rides per Bike in "+g(B.value),1),t("div",te,[p(l,{data:A.value,columns:O,state:f.value,"on-state-change":F,"on-select":(a,n)=>E(n.bike),"selected-row-id":Y.value},null,8,["data","state","on-select","selected-row-id"])])])]),t("div",se,[s[2]||(s[2]=t("h2",{class:"text-xl font-semibold mb-3"},"Rides Over 100km per Year",-1)),t("div",ae,[p(l,{data:J.value,columns:P,state:y.value,"on-state-change":M,"on-select":(a,n)=>G(n.year),"selected-row-id":x.value},null,8,["data","state","on-select","selected-row-id"])])]),t("div",ne,[s[4]||(s[4]=t("h2",{class:"text-xl font-semibold mb-3"},"Monthly Totals by Year",-1)),t("div",le,[t("table",oe,[t("thead",null,[t("tr",re,[s[3]||(s[3]=t("th",{class:"p-2"},"Year",-1)),(c(),i(L,null,T(q,a=>t("th",{class:"p-2",key:a},g(a),1)),64))])]),t("tbody",null,[(c(!0),i(L,null,T(N.value,a=>(c(),i("tr",{key:a},[t("td",ie,g(a),1),(c(),i(L,null,T([1,2,3,4,5,6,7,8,9,10,11,12],n=>t("td",{key:`${a}-${n}`,class:"p-2 border-l text-xs"},[w(a,n)?(c(),i("div",ce,[t("div",null,g(w(a,n).distance)+" km",1),t("div",de,g(w(a,n).rides)+" rides",1)])):(c(),i("div",ue,"-"))])),64))]))),128))])])])])])}}});export{me as default};
