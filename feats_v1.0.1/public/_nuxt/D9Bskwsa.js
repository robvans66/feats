import{_ as Q}from"./Q0vLka2Z.js";import{e as U,f as W,$ as X,c,a as s,d as B,t as v,b as p,F as w,m as L,q as d,r,o as u}from"./ziwEr0Sq.js";const Z={class:"fun-fact mb-8 p-4"},ee={class:"text-lg font-semibold"},te={class:"circumferences font-bold"},se={class:"grid gap-15 lg:grid-cols-3"},ae={class:"table-statistics bg-white border"},ne={class:"table-statistics bg-white border"},oe={class:"text-xl font-semibold mb-3"},le={class:"table-statistics bg-white border"},re={class:"mt-12"},ie={class:"table-statistics bg-white border"},ce={class:"mt-12"},de={class:"bg-white border overflow-x-auto"},ue={class:"table-statistics min-w-full"},ve={class:"bg-gray-100"},ge={class:"p-2 font-semibold"},be={key:0},me={class:"text-gray-600"},fe={key:1,class:"text-gray-400"},pe=U({__name:"statistics",setup(ye){const D=d(()=>new Date().getFullYear()),l=r({yearTotals:[],perBike:[],longestPerYear:[],monthlyTotals:[],ridesOver100ByYear:[]}),S=r(null),Y=r(null),x=r(null),T=r(null),m=r({sorting:[]}),f=r({sorting:[]}),y=r({sorting:[]}),h=r({sorting:[{id:"year",desc:!0}]}),K=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"distance",headerLabel:"Distance",enableSorting:!0},{accessorKey:"rides",headerLabel:"Total Rides",enableSorting:!0}],O=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"longest",headerLabel:"Longest Ride",enableSorting:!0}],R=[{accessorKey:"bike",headerLabel:"Bike",enableSorting:!0},{accessorKey:"distance",headerLabel:"Distance",enableSorting:!0},{accessorKey:"rides",headerLabel:"Number",enableSorting:!0}],M=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"count",headerLabel:"Rides > 100km",enableSorting:!0},{accessorKey:"distancesFormatted",headerLabel:"Distances (km)",enableSorting:!1,cell:e=>e.getValue()}];function P(e){m.value=typeof e=="function"?e(m.value):e}function C(e){f.value=typeof e=="function"?e(f.value):e}function F(e){y.value=typeof e=="function"?e(y.value):e}function V(e){h.value=typeof e=="function"?e(h.value):e}const $=d(()=>{const e=_(l.value.yearTotals,m.value.sorting),t=l.value.yearTotals.reduce((n,i)=>n+(i.distance||0),0),o=l.value.yearTotals.reduce((n,i)=>n+(i.rides||0),0),a={year:"Grand Total",distance:Math.round(t*100)/100,rides:o,isGrandTotal:!0};return[...e,a]}),A=d(()=>_(l.value.longestPerYear,f.value.sorting)),G=d(()=>_(l.value.perBike,y.value.sorting)),J=d(()=>{const e=l.value.ridesOver100ByYear.map(t=>{const o=t.distances||[],a=o.slice(0,15),n=o.length-15;let i=a.join(", ");return n>0&&(i+=` and ${n} more`),{...t,distancesFormatted:i}});return _(e,h.value.sorting)});function _(e,t){if(!t||t.length===0)return e;const o=t[0],a=[...e].sort((n,i)=>{const g=n[o.id],b=i[o.id];return g===b?0:g==null?1:b==null?-1:typeof g=="number"&&typeof b=="number"?g-b:String(g).localeCompare(String(b))});return o.desc?a.reverse():a}const N=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],q=d(()=>{const e=new Set(l.value.monthlyTotals.map(t=>t.year));return Array.from(e).sort((t,o)=>o-t)});function k(e,t){const o=String(t).padStart(2,"0");return l.value.monthlyTotals.find(a=>a.year===e&&a.month===o)}function j(e){S.value=S.value===e?null:e}function E(e){Y.value=Y.value===e?null:e}function z(e){x.value=x.value===e?null:e}function H(e){T.value=T.value===e?null:e}W(async()=>{const e=await X("/api/stats");l.value=e});const I=d(()=>{const e=l.value.yearTotals.reduce((t,o)=>t+(o.distance||0),0);return Math.round(e/4e4*100)/100});return(e,t)=>{const o=Q;return u(),c("section",null,[t[7]||(t[7]=s("h1",{class:"text-3xl font-semibold mb-6"},"Statistics",-1)),s("div",Z,[s("p",ee,[t[0]||(t[0]=B(" Great! You cycled around the earth ",-1)),s("span",te,v(I.value),1),t[1]||(t[1]=B(" times. Keep on pedaling! ",-1))])]),s("div",se,[s("div",null,[t[2]||(t[2]=s("h2",{class:"text-xl font-semibold mb-3"},"Year Totals",-1)),s("div",ae,[p(o,{id:"year-totals",data:$.value,columns:K,state:m.value,"on-state-change":P,"on-select":(a,n)=>j(n.year),"selected-row-id":S.value},null,8,["data","state","on-select","selected-row-id"])])]),s("div",null,[t[3]||(t[3]=s("h2",{class:"text-xl font-semibold mb-3"},"Longest Ride per Year",-1)),s("div",ne,[p(o,{data:A.value,columns:O,state:f.value,"on-state-change":C,"on-select":(a,n)=>z(n.year),"selected-row-id":x.value},null,8,["data","state","on-select","selected-row-id"])])]),s("div",null,[s("h2",oe,"Distance and Rides per Bike in "+v(D.value),1),s("div",le,[p(o,{data:G.value,columns:R,state:y.value,"on-state-change":F,"on-select":(a,n)=>E(n.bike),"selected-row-id":Y.value},null,8,["data","state","on-select","selected-row-id"])])])]),s("div",re,[t[4]||(t[4]=s("h2",{class:"text-xl font-semibold mb-3"},"Rides Over 100km per Year",-1)),s("div",ie,[p(o,{data:J.value,columns:M,state:h.value,"on-state-change":V,"on-select":(a,n)=>H(n.year),"selected-row-id":T.value},null,8,["data","state","on-select","selected-row-id"])])]),s("div",ce,[t[6]||(t[6]=s("h2",{class:"text-xl font-semibold mb-3"},"Monthly Totals by Year",-1)),s("div",de,[s("table",ue,[s("thead",null,[s("tr",ve,[t[5]||(t[5]=s("th",{class:"p-2"},"Year",-1)),(u(),c(w,null,L(N,a=>s("th",{class:"p-2",key:a},v(a),1)),64))])]),s("tbody",null,[(u(!0),c(w,null,L(q.value,a=>(u(),c("tr",{key:a},[s("td",ge,v(a),1),(u(),c(w,null,L([1,2,3,4,5,6,7,8,9,10,11,12],n=>s("td",{key:`${a}-${n}`,class:"p-2 border-l text-xs"},[k(a,n)?(u(),c("div",be,[s("div",null,v(k(a,n).distance)+" km",1),s("div",me,v(k(a,n).rides)+" rides",1)])):(u(),c("div",fe,"-"))])),64))]))),128))])])])])])}}});export{pe as default};
