import{_ as H}from"./BrfNhafR.js";import{e as I,f as Q,$ as U,c,a as s,b as p,t as b,F as w,m as L,q as u,r,o as d}from"./CCdDhOU6.js";const W={class:"grid gap-15 lg:grid-cols-3"},X={class:"table-statistics bg-white border"},Z={class:"table-statistics bg-white border"},ee={class:"text-xl font-semibold mb-3"},te={class:"table-statistics bg-white border"},se={class:"mt-12"},ae={class:"table-statistics bg-white border"},ne={class:"mt-12"},oe={class:"bg-white border overflow-x-auto"},le={class:"table-statistics min-w-full"},re={class:"bg-gray-100"},ie={class:"p-2 font-semibold"},ce={key:0},de={class:"text-gray-600"},ue={key:1,class:"text-gray-400"},me=I({__name:"statistics",setup(ve){const B=u(()=>new Date().getFullYear()),l=r({yearTotals:[],perBike:[],longestPerYear:[],monthlyTotals:[],ridesOver100ByYear:[]}),S=r(null),Y=r(null),k=r(null),x=r(null),m=r({sorting:[]}),y=r({sorting:[]}),f=r({sorting:[]}),h=r({sorting:[{id:"year",desc:!0}]}),D=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"distance",headerLabel:"Distance",enableSorting:!0},{accessorKey:"rides",headerLabel:"Total Rides",enableSorting:!0}],K=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"longest",headerLabel:"Longest Ride",enableSorting:!0}],O=[{accessorKey:"bike",headerLabel:"Bike",enableSorting:!0},{accessorKey:"distance",headerLabel:"Distance",enableSorting:!0},{accessorKey:"rides",headerLabel:"Number",enableSorting:!0}],R=[{accessorKey:"year",headerLabel:"Year",enableSorting:!0},{accessorKey:"count",headerLabel:"Rides > 100km",enableSorting:!0},{accessorKey:"distancesFormatted",headerLabel:"Distances (km)",enableSorting:!1,cell:e=>e.getValue()}];function P(e){m.value=typeof e=="function"?e(m.value):e}function M(e){y.value=typeof e=="function"?e(y.value):e}function C(e){f.value=typeof e=="function"?e(f.value):e}function F(e){h.value=typeof e=="function"?e(h.value):e}const V=u(()=>{const e=_(l.value.yearTotals,m.value.sorting),t=l.value.yearTotals.reduce((n,i)=>n+(i.distance||0),0),o=l.value.yearTotals.reduce((n,i)=>n+(i.rides||0),0),a={year:"Grand Total",distance:Math.round(t*100)/100,rides:o,isGrandTotal:!0};return[...e,a]}),$=u(()=>_(l.value.longestPerYear,y.value.sorting)),A=u(()=>_(l.value.perBike,f.value.sorting)),J=u(()=>{const e=l.value.ridesOver100ByYear.map(t=>{const o=t.distances||[],a=o.slice(0,15),n=o.length-15;let i=a.join(", ");return n>0&&(i+=` and ${n} more`),{...t,distancesFormatted:i}});return _(e,h.value.sorting)});function _(e,t){if(!t||t.length===0)return e;const o=t[0],a=[...e].sort((n,i)=>{const v=n[o.id],g=i[o.id];return v===g?0:v==null?1:g==null?-1:typeof v=="number"&&typeof g=="number"?v-g:String(v).localeCompare(String(g))});return o.desc?a.reverse():a}const q=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],G=u(()=>{const e=new Set(l.value.monthlyTotals.map(t=>t.year));return Array.from(e).sort((t,o)=>o-t)});function T(e,t){const o=String(t).padStart(2,"0");return l.value.monthlyTotals.find(a=>a.year===e&&a.month===o)}function N(e){S.value=S.value===e?null:e}function j(e){Y.value=Y.value===e?null:e}function E(e){k.value=k.value===e?null:e}function z(e){x.value=x.value===e?null:e}return Q(async()=>{const e=await U("/api/stats");l.value=e}),(e,t)=>{const o=H;return d(),c("section",null,[t[5]||(t[5]=s("h1",{class:"text-3xl font-semibold mb-6"},"Statistics",-1)),s("div",W,[s("div",null,[t[0]||(t[0]=s("h2",{class:"text-xl font-semibold mb-3"},"Year Totals",-1)),s("div",X,[p(o,{id:"year-totals",data:V.value,columns:D,state:m.value,"on-state-change":P,"on-select":(a,n)=>N(n.year),"selected-row-id":S.value},null,8,["data","state","on-select","selected-row-id"])])]),s("div",null,[t[1]||(t[1]=s("h2",{class:"text-xl font-semibold mb-3"},"Longest Ride per Year",-1)),s("div",Z,[p(o,{data:$.value,columns:K,state:y.value,"on-state-change":M,"on-select":(a,n)=>E(n.year),"selected-row-id":k.value},null,8,["data","state","on-select","selected-row-id"])])]),s("div",null,[s("h2",ee,"Distance and Rides per Bike in "+b(B.value),1),s("div",te,[p(o,{data:A.value,columns:O,state:f.value,"on-state-change":C,"on-select":(a,n)=>j(n.bike),"selected-row-id":Y.value},null,8,["data","state","on-select","selected-row-id"])])])]),s("div",se,[t[2]||(t[2]=s("h2",{class:"text-xl font-semibold mb-3"},"Rides Over 100km per Year",-1)),s("div",ae,[p(o,{data:J.value,columns:R,state:h.value,"on-state-change":F,"on-select":(a,n)=>z(n.year),"selected-row-id":x.value},null,8,["data","state","on-select","selected-row-id"])])]),s("div",ne,[t[4]||(t[4]=s("h2",{class:"text-xl font-semibold mb-3"},"Monthly Totals by Year",-1)),s("div",oe,[s("table",le,[s("thead",null,[s("tr",re,[t[3]||(t[3]=s("th",{class:"p-2"},"Year",-1)),(d(),c(w,null,L(q,a=>s("th",{class:"p-2",key:a},b(a),1)),64))])]),s("tbody",null,[(d(!0),c(w,null,L(G.value,a=>(d(),c("tr",{key:a},[s("td",ie,b(a),1),(d(),c(w,null,L([1,2,3,4,5,6,7,8,9,10,11,12],n=>s("td",{key:`${a}-${n}`,class:"p-2 border-l text-xs"},[T(a,n)?(d(),c("div",ce,[s("div",null,b(T(a,n).distance)+" km",1),s("div",de,b(T(a,n).rides)+" rides",1)])):(d(),c("div",ue,"-"))])),64))]))),128))])])])])])}}});export{me as default};
