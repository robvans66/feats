import{_ as ce,a as pe}from"./B-jOZTf8.js";import{_ as ve,a as fe}from"./Dh-7-jKO.js";import{_ as be}from"./DaMlzqSp.js";import{e as me,i as y,f as ge,$ as x,h as ye,r as u,c as O,a,j as c,v as p,b as S,k,t as v,l as xe,F as Se,m as ke,n as j,p as we,q as E,s as _e,o as L,x as he,d as Ve,y as Ce}from"./DIRT6zXZ.js";import{u as Ie}from"./Cey6L-wt.js";import"./wJfVS7KU.js";const Le={class:"grid grid-cols-7 gap-4"},De={class:"col-span-2"},ze={class:"col-span-1"},Te={class:"col-span-1"},Ue={class:"col-span-1"},Re={class:"col-span-1"},Ne={class:"col-span-1"},Oe={class:"col-span-2"},Ee={class:"col-span-1"},Ke=["disabled"],$e={class:"col-span-3"},Ae={class:"col-span-1 flex items-end space-x-2"},Fe=["disabled"],Pe=["disabled"],Je={class:"flex items-center justify-between mt-4 mb-4"},Be={class:"flex items-center space-x-2"},Ge=["disabled"],Me=["disabled"],qe={class:"flex items-center space-x-2"},je={class:"relative z-20"},He={key:0,class:"absolute right-0 mt-2 bg-white dark:bg-gray-800 border dark:border-gray-700 p-2 shadow z-30 w-max"},Qe=["onUpdate:modelValue"],We={class:"table-routes bg-white border overflow-x-auto relative"},Xe={class:"flex items-center justify-between mt-3"},Ye={class:"space-x-2"},Ze=["disabled"],et=["disabled"],ut=me({__name:"routes",setup(tt){const D=[{key:"id",label:"ID"},{key:"description",label:"Description"},{key:"distance",label:"Distance"},{key:"start",label:"Start"},{key:"destination",label:"Destination"},{key:"grade",label:"Grade"},{key:"surface",label:"Surface"},{key:"reference",label:"Reference"},{key:"link",label:"Link"},{key:"notes",label:"Notes"}],w=u(["Road","Gravel","Road/Gravel","Gravel/MTB"]),_=u([5,10,20]),z=u([]),f=u(0),H=u(0),Q=u(""),o=u([]),b=u(!1),T=u(!1),W=D.map(t=>t.key),K=u(W),s=u({id:null,description:"",distance:null,start:"",destination:"",grade:null,surface:"Road",reference:"",link:"",notes:""}),d=u(""),h=u(!1),$={base:"border border-[var(--fts-ui-primary)] bg-[var(--fts-ui-bg-input-form)] text-[var(--fts-ui-primary)] rounded-[4px] min-h-[34px] px-2 py-1 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--fts-ui-button)] focus-visible:ring-inset"};let A=null;y(Q,t=>{clearTimeout(A),A=setTimeout(()=>{H.value=0},300)}),y(K,t=>{typeof window>"u"||localStorage.setItem("routes_visible_columns",JSON.stringify(t))},{deep:!0});let F=null;async function V(t){const e=t||l.value,r=e.pagination?.pageIndex||0,i=e.pagination?.pageSize||10,R=e.globalFilter||"",C=e.sorting&&e.sorting[0]||null,N=C?.id||"distance",n=C?.desc?"desc":"asc",g=new URLSearchParams({page:String(r),pageSize:String(i),filter:R,sortBy:N,sortDir:n});G(!0);try{const I=await x(`/api/routes?${g.toString()}`);z.value=I.rows||[],f.value=I.total||0}catch(I){d.value=I?.message||"Failed to load routes",setTimeout(()=>d.value="",3e3)}finally{G(!1)}}ge(async()=>{const t=localStorage.getItem("routes_visible_columns");if(t)try{const i=JSON.parse(t);i&&(K.value=i)}catch{}const e=localStorage.getItem("routes_column_visibility");if(e)try{const i=JSON.parse(e);i&&(l.value.columnVisibility=i)}catch{}const r=localStorage.getItem("routes_sorting");if(r)try{const i=JSON.parse(r);Array.isArray(i)&&(l.value.sorting=i)}catch{}try{const i=await x("/api/config");U(i)}catch{}typeof window<"u"&&(window.addEventListener("user-config-updated",P),window.addEventListener("storage",J)),V()}),ye(()=>{typeof window<"u"&&(window.removeEventListener("user-config-updated",P),window.removeEventListener("storage",J))});function U(t){t&&(Array.isArray(t.surfaceOptions)&&t.surfaceOptions.length&&(w.value=t.surfaceOptions),Array.isArray(t.pageSizeOptions)&&t.pageSizeOptions.length&&(_.value=t.pageSizeOptions),w.value.includes(s.value.surface)||(s.value.surface=w.value[0]||""),_.value.includes(l.value.pagination.pageSize||10)||(l.value.pagination.pageSize=_.value[0]||10,l.value.pagination.pageIndex=0),t.routesColumnVisibility&&(l.value.columnVisibility={...B,...t.routesColumnVisibility},localStorage.setItem("routes_column_visibility",JSON.stringify(l.value.columnVisibility))))}function P(t){const e=t.detail;U(e)}function J(t){if(!(t.key!=="user_config"||!t.newValue))try{const e=JSON.parse(t.newValue);U(e)}catch{}}function X(t){clearTimeout(F),F=setTimeout(()=>V(t),200)}const B=D.reduce((t,e)=>(t[e.key]=!0,t),{}),l=u({globalFilter:"",sorting:[{id:"link",desc:!0}],pagination:{pageIndex:0,pageSize:10},columnVisibility:B});y(()=>l.value.columnVisibility,t=>{typeof window>"u"||localStorage.setItem("routes_column_visibility",JSON.stringify(t))},{deep:!0}),y(()=>l.value.sorting,t=>{typeof window>"u"||localStorage.setItem("routes_sorting",JSON.stringify(t||[]))},{deep:!0}),y(l,t=>X(t),{deep:!0});const{loading:m,setLoading:G}=Ie(),M=E(()=>(l.value.pagination?.pageIndex||0)*(l.value.pagination?.pageSize||10)),Y=E(()=>Math.min(M.value+(l.value.pagination?.pageSize||10),f.value)),Z=E(()=>[{accessorKey:"id",headerLabel:"ID",enableSorting:!0},{accessorKey:"description",headerLabel:"Description",enableSorting:!0},{accessorKey:"distance",headerLabel:"Distance",enableSorting:!0},{accessorKey:"start",headerLabel:"Start"},{accessorKey:"destination",headerLabel:"Destination"},{accessorKey:"grade",headerLabel:"Grade"},{accessorKey:"surface",headerLabel:"Surface"},{accessorKey:"reference",headerLabel:"Reference"},{accessorKey:"link",headerLabel:"Link",enableSorting:!0,cell:t=>{const e=t.getValue();return t.row.original.reference?Ce("a",{href:t.row.original.reference,target:"_blank",class:"text-blue-600 hover:underline"},e||"Link"):e||""}},{accessorKey:"notes",headerLabel:"Notes"}]);function ee(t){l.value=typeof t=="function"?t(l.value):t}function te(){(l.value.pagination.pageIndex||0)>0&&l.value.pagination.pageIndex--}function ae(){const t=l.value.pagination.pageIndex||0,e=l.value.pagination.pageSize||10;(t+1)*e<f.value&&l.value.pagination.pageIndex++}function le(t){l.value.pagination.pageSize=t,l.value.pagination.pageIndex=0}function ne(t){o.value=t.map(e=>Number(e))}function se(t,e){if(!t.ctrlKey&&!t.metaKey){const r=e?.id;o.value.includes(r)?o.value=[]:o.value=[r]}}function oe(){if(o.value.length!==1)return;const t=o.value[0],e=z.value.find(i=>i.id===t);if(!e)return;b.value=!0;const r=e;s.value={...r},_e(()=>{document.querySelector("input[type=text]")?.focus()})}function ie(){o.value.length!==0&&(h.value=!0)}async function ue(){if(o.value.length!==0)try{await Promise.all(o.value.map(t=>x(`/api/routes?id=${t}`,{method:"DELETE"}))),h.value=!1,d.value=`${o.value.length} route${o.value.length>1?"s":""} deleted`,setTimeout(()=>d.value="",2500),o.value=[],V()}catch{d.value="Failed to delete routes",setTimeout(()=>d.value="",2500)}}function re(){s.value.reference?s.value.link||(s.value.link="Link"):s.value.link=""}function q(){s.value={id:null,description:"",distance:null,grade:null,start:"",destination:"",surface:"Road",reference:"",link:"",notes:""},b.value=!1}async function de(){if(b.value)await x("/api/routes",{method:"PUT",body:s.value}),b.value=!1,o.value=[],d.value="Route updated";else{const t={...s.value};t.reference&&!t.link&&(t.link="Link"),await x("/api/routes",{method:"POST",body:t}),d.value="Route added"}setTimeout(()=>d.value="",2500),q(),V()}return(t,e)=>{const r=ce,i=ve,R=fe,C=be,N=pe;return L(),O("section",null,[a("form",{onSubmit:xe(de,["prevent"]),class:"fts p-6 mb-6 border-color rounded"},[e[23]||(e[23]=a("h1",{class:"text-3xl font-semibold mb-6"},"Add a Route",-1)),a("div",Le,[a("div",De,[e[14]||(e[14]=a("label",{class:"block"},"Description*",-1)),c(a("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.value.description=n),type:"text",required:"",class:"border px-2 py-1 w-full"},null,512),[[p,s.value.description]])]),a("div",ze,[e[15]||(e[15]=a("label",{class:"block"},"Distance * (km)",-1)),c(a("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.value.distance=n),type:"number",step:"0.1",required:"",class:"border px-2 py-1 w-full"},null,512),[[p,s.value.distance,void 0,{number:!0}]])]),a("div",Te,[e[16]||(e[16]=a("label",{class:"block"},"Start*",-1)),c(a("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>s.value.start=n),type:"text",required:"",class:"border px-2 py-1 w-full"},null,512),[[p,s.value.start]])]),a("div",Ue,[e[17]||(e[17]=a("label",{class:"block"},"Destination*",-1)),c(a("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>s.value.destination=n),type:"text",required:"",class:"border px-2 py-1 w-full"},null,512),[[p,s.value.destination]])]),a("div",Re,[e[18]||(e[18]=a("label",{class:"block"},"Grade (%)",-1)),c(a("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.value.grade=n),type:"number",step:"0.1",class:"border px-2 py-1 w-full"},null,512),[[p,s.value.grade,void 0,{number:!0}]])]),a("div",Ne,[e[19]||(e[19]=a("label",{class:"block"},"Surface*",-1)),S(r,{modelValue:s.value.surface,"onUpdate:modelValue":e[5]||(e[5]=n=>s.value.surface=n),items:w.value,ui:$,class:"w-full",variant:"none"},null,8,["modelValue","items"])]),a("div",Oe,[e[20]||(e[20]=a("label",{class:"block"},"Reference",-1)),c(a("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>s.value.reference=n),type:"text",class:"border px-2 py-1 w-full",onInput:re},null,544),[[p,s.value.reference]])]),a("div",Ee,[e[21]||(e[21]=a("label",{class:"block"},"Link",-1)),c(a("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>s.value.link=n),disabled:!s.value.reference,type:"text",class:"border px-2 py-1 w-full"},null,8,Ke),[[p,s.value.link]])]),a("div",$e,[e[22]||(e[22]=a("label",{class:"block"},"Notes",-1)),c(a("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>s.value.notes=n),type:"text",class:"border px-2 py-1 w-full"},null,512),[[p,s.value.notes]])]),a("div",Ae,[a("button",{type:"submit",class:"px-3 py-1 fts",disabled:k(m)},v(b.value?"Update":"Add"),9,Fe),a("button",{type:"button",onClick:q,class:"px-3 py-1 border fts",disabled:k(m)},"Clear",8,Pe)])])],32),S(i,{show:h.value,title:"Delete Route",message:`Are you sure you want to delete ${o.value.length} route${o.value.length>1?"s":""}?`,onConfirm:ue,onCancel:e[9]||(e[9]=()=>h.value=!1)},null,8,["show","message"]),S(R,{message:d.value},null,8,["message"]),e[24]||(e[24]=a("h1",{class:"text-3xl font-semibold mb-6 mt-10"},"Planned Routes",-1)),a("div",Je,[a("div",Be,[a("button",{class:"px-3 py-1 fts disabled:opacity-50",disabled:o.value.length!==1||k(m),onClick:oe},"Edit",8,Ge),a("button",{class:"px-3 py-1 fts-delete disabled:opacity-50",disabled:o.value.length===0||k(m),onClick:ie},"Delete "+v(o.value.length>1?`(${o.value.length})`:""),9,Me)]),a("div",qe,[c(a("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>l.value.globalFilter=n),placeholder:"Search",class:"border px-2 py-1"},null,512),[[p,l.value.globalFilter]]),S(r,{modelValue:l.value.pagination.pageSize,"onUpdate:modelValue":[e[11]||(e[11]=n=>l.value.pagination.pageSize=n),e[12]||(e[12]=n=>le(n))],items:_.value,ui:$,class:"w-24",variant:"none"},null,8,["modelValue","items"]),a("div",je,[a("button",{onClick:e[13]||(e[13]=n=>T.value=!T.value),class:"border px-2 py-1"},"Columns â–¾"),T.value?(L(),O("div",He,[(L(),O(Se,null,ke(D,n=>a("label",{key:n.key,class:"block dark:text-white"},[c(a("input",{type:"checkbox","onUpdate:modelValue":g=>l.value.columnVisibility[n.key]=g},null,8,Qe),[[he,l.value.columnVisibility[n.key]]]),Ve(" "+v(n.label),1)])),64))])):j("",!0)])])]),a("div",We,[S(C,{data:z.value,columns:Z.value,state:l.value,multiSelect:!0,selectedRowIds:o.value,onSelectionChange:ne,onStateChange:ee,onSelect:(n,g)=>se(n,g)},null,8,["data","columns","state","selectedRowIds","onSelect"]),k(m)?(L(),we(N,{key:0})):j("",!0)]),a("div",Xe,[a("div",null,"Showing "+v(M.value+1)+" - "+v(Y.value)+" of "+v(f.value),1),a("div",Ye,[a("button",{onClick:te,disabled:(l.value.pagination.pageIndex||0)===0,class:"px-2 py-1 border"},"Prev",8,Ze),a("button",{onClick:ae,disabled:((l.value.pagination.pageIndex||0)+1)*(l.value.pagination.pageSize||10)>=f.value,class:"px-2 py-1 border"},"Next",8,et)])])])}}});export{ut as default};
