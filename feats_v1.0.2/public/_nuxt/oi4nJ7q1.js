import{_ as ne,a as se}from"./Dh-7-jKO.js";import{e as oe,f as ie,c as d,a as t,j as T,v as $,ai as I,F as x,m as C,b as j,r as u,$ as L,o as c,t as O,x as q}from"./DIRT6zXZ.js";const ae={class:"fts"},le={class:"fts p-4 mt-3 mb-6 border-color rounded"},re={class:"grid gap-4 lg:grid-cols-3"},ue={class:"fts-cfg-options"},de={class:"flex items-center gap-2 mt-1"},ce={class:"flex flex-wrap gap-2 mt-2"},pe=["onClick"],fe={class:"fts-cfg-options"},be={class:"flex items-center gap-2 mt-1"},ve={class:"flex flex-wrap gap-2 mt-2"},ge=["onClick"],ye={class:"fts-cfg-options"},ke={class:"flex items-center gap-2 mt-1"},me={class:"flex flex-wrap gap-2 mt-2"},_e=["onClick"],Te={class:"grid gap-4 mt-8 lg:grid-cols-2"},xe={class:"fts-cfg-options"},Ce={class:"grid gap-2 mt-2 sm:grid-cols-2 p-3 rounded"},Oe=["onUpdate:modelValue"],Ee={class:"fts-cfg-options"},Se={class:"grid gap-2 mt-2 sm:grid-cols-2"},Re=["onUpdate:modelValue"],we={class:"fts-cfg-options-buttons flex justify-end gap-3 mt-6"},he=["disabled"],Le=["disabled"],Ae={class:"fts-cfg-options flex gap-3 mt-6"},Ue=["disabled"],$e=oe({__name:"configuration",setup(Ne){const A=u(!1),p=u([]),f=u([]),b=u([]),g=u({}),y=u({}),E=u(""),S=u(""),R=u(""),k=u(!1),U=u(""),w=u(!1),N=[{key:"id",label:"ID"},{key:"date",label:"Date"},{key:"description",label:"Description"},{key:"distance",label:"Distance"},{key:"average",label:"Average"},{key:"grade",label:"Grade"},{key:"bike",label:"Bike"},{key:"reference",label:"Reference"},{key:"link",label:"Link"},{key:"notes",label:"Notes"}],V=[{key:"id",label:"ID"},{key:"description",label:"Description"},{key:"distance",label:"Distance"},{key:"start",label:"Start"},{key:"destination",label:"Destination"},{key:"grade",label:"Grade"},{key:"surface",label:"Surface"},{key:"reference",label:"Reference"},{key:"link",label:"Link"},{key:"notes",label:"Notes"}];function h(e,n){const l={};for(const v of e)l[v.key]=n?.[v.key]??!0;return l}function B(){return{bikeOptions:["Santos","Rimonta","Gazelle","Wahoo"],surfaceOptions:["Road","Gravel","Road/Gravel","Gravel/MTB"],pageSizeOptions:[5,10,20],ridesColumnVisibility:h(N,void 0),routesColumnVisibility:h(V,void 0)}}function K(e){typeof window>"u"||(localStorage.setItem("user_config",JSON.stringify(e)),window.dispatchEvent(new CustomEvent("user-config-updated",{detail:e})))}function X(e,n){const l=n.trim();return!l||e.includes(l)?e:[...e,l]}function Y(e,n){return!Number.isFinite(n)||n<=0||e.includes(n)?e:[...e,n]}function z(){p.value=X(p.value,E.value),E.value=""}function F(){f.value=X(f.value,S.value),S.value=""}function G(){const e=Number(R.value);b.value=Y(b.value,e),R.value=""}function J(e){p.value=p.value.filter((n,l)=>l!==e)}function Q(e){f.value=f.value.filter((n,l)=>l!==e)}function W(e){b.value=b.value.filter((n,l)=>l!==e)}async function H(){try{const e=await L("/api/config"),n=B();p.value=Array.isArray(e?.bikeOptions)?e.bikeOptions:n.bikeOptions,f.value=Array.isArray(e?.surfaceOptions)?e.surfaceOptions:n.surfaceOptions,b.value=Array.isArray(e?.pageSizeOptions)?e.pageSizeOptions:n.pageSizeOptions,g.value=h(N,e?.ridesColumnVisibility),y.value=h(V,e?.routesColumnVisibility)}catch{m("Failed to load configuration.")}}async function P(){k.value=!0;const e={bikeOptions:p.value,surfaceOptions:f.value,pageSizeOptions:b.value,ridesColumnVisibility:g.value,routesColumnVisibility:y.value};try{await L("/api/config",{method:"PUT",body:e}),K(e),m("Configuration saved.")}catch{m("Failed to save configuration.")}finally{k.value=!1}}function Z(){w.value=!1;const e=B();p.value=[...e.bikeOptions],f.value=[...e.surfaceOptions],b.value=[...e.pageSizeOptions],g.value={...e.ridesColumnVisibility},y.value={...e.routesColumnVisibility},P()}async function ee(){A.value=!0;try{const n=(await L("/api/rides?pageSize=10000&page=0")).rows||[],v=(await L("/api/routes?pageSize=10000&page=0")).rows||[],o=localStorage.getItem("user_config"),r=o?JSON.parse(o):null;let s=`-- Feats Backup
`;if(s+=`-- Generated: ${new Date().toISOString()}

`,s+=`-- Rides Table
`,s+=`DROP TABLE IF EXISTS rides_table;
`,s+=`CREATE TABLE rides_table (
`,s+=`  id INTEGER PRIMARY KEY,
`,s+=`  date TEXT,
`,s+=`  description TEXT,
`,s+=`  distance REAL,
`,s+=`  average REAL,
`,s+=`  grade TEXT,
`,s+=`  bike TEXT,
`,s+=`  reference TEXT,
`,s+=`  link TEXT,
`,s+=`  notes TEXT
`,s+=`);

`,n&&n.length>0){for(const i of n){const D=[i.id||"NULL",a(i.date),a(i.description),i.distance||"NULL",i.average||"NULL",a(i.grade),a(i.bike),a(i.reference),a(i.link),a(i.notes)].join(", ");s+=`INSERT INTO rides_table (id, date, description, distance, average, grade, bike, reference, link, notes) VALUES (${D});
`}s+=`
`}if(s+=`-- Routes Table
`,s+=`DROP TABLE IF EXISTS routes_table;
`,s+=`CREATE TABLE routes_table (
`,s+=`  id INTEGER PRIMARY KEY,
`,s+=`  description TEXT,
`,s+=`  distance REAL,
`,s+=`  grade TEXT,
`,s+=`  start TEXT,
`,s+=`  destination TEXT,
`,s+=`  surface TEXT,
`,s+=`  reference TEXT,
`,s+=`  link TEXT,
`,s+=`  notes TEXT
`,s+=`);

`,v&&v.length>0){for(const i of v){const D=[i.id||"NULL",a(i.description),i.distance||"NULL",a(i.grade),a(i.start),a(i.destination),a(i.surface),a(i.reference),a(i.link),a(i.notes)].join(", ");s+=`INSERT INTO routes_table (id, description, distance, grade, start, destination, surface, reference, link, notes) VALUES (${D});
`}s+=`
`}r&&(s+=`-- User Configuration
`,s+=`-- ${JSON.stringify(r)}
`);const te=new Blob([s],{type:"application/sql"}),M=URL.createObjectURL(te),_=document.createElement("a");_.href=M,_.download=`feats-backup-${new Date().toISOString().split("T")[0]}.sql`,document.body.appendChild(_),_.click(),document.body.removeChild(_),URL.revokeObjectURL(M),m("Backup downloaded successfully.")}catch{m("Failed to create backup.")}finally{A.value=!1}}function a(e){return e==null||e===""?"NULL":`'${String(e).replace(/'/g,"''")}'`}function m(e){U.value=e,setTimeout(()=>{U.value=""},2500)}return ie(H),(e,n)=>{const l=ne,v=se;return c(),d("section",ae,[n[11]||(n[11]=t("h1",{class:"text-2xl pt-8 font-semibold ml-7 mb-4"},"Configuration",-1)),t("div",le,[t("div",re,[t("div",ue,[n[5]||(n[5]=t("label",{class:"block"},"Bike Options",-1)),t("div",de,[T(t("input",{"onUpdate:modelValue":n[0]||(n[0]=o=>E.value=o),type:"text",class:"border px-2 py-1 w-full",placeholder:"Add bike",onKeyup:I(z,["enter"])},null,544),[[$,E.value]]),t("button",{class:"fts px-3 py-1",type:"button",onClick:z},"Add")]),t("div",ce,[(c(!0),d(x,null,C(p.value,(o,r)=>(c(),d("span",{key:`${o}-${r}`,class:"fts-option-item inline-flex items-center gap-2 px-2 py-1 border rounded"},[t("span",null,O(o),1),t("button",{class:"text-xs",type:"button",onClick:s=>J(r)},"x",8,pe)]))),128))])]),t("div",fe,[n[6]||(n[6]=t("label",{class:"block"},"Surface Options",-1)),t("div",be,[T(t("input",{"onUpdate:modelValue":n[1]||(n[1]=o=>S.value=o),type:"text",class:"border px-2 py-1 w-full",placeholder:"Add surface",onKeyup:I(F,["enter"])},null,544),[[$,S.value]]),t("button",{class:"fts px-3 py-1",type:"button",onClick:F},"Add")]),t("div",ve,[(c(!0),d(x,null,C(f.value,(o,r)=>(c(),d("span",{key:`${o}-${r}`,class:"fts-option-item inline-flex items-center gap-2 px-2 py-1 border rounded"},[t("span",null,O(o),1),t("button",{class:"text-xs",type:"button",onClick:s=>Q(r)},"x",8,ge)]))),128))])]),t("div",ye,[n[7]||(n[7]=t("label",{class:"block"},"Page Size Options",-1)),t("div",ke,[T(t("input",{"onUpdate:modelValue":n[2]||(n[2]=o=>R.value=o),type:"number",min:"1",step:"1",class:"border px-2 py-1 w-full",placeholder:"Add size",onKeyup:I(G,["enter"])},null,544),[[$,R.value]]),t("button",{class:"fts px-3 py-1",type:"button",onClick:G},"Add")]),t("div",me,[(c(!0),d(x,null,C(b.value,(o,r)=>(c(),d("span",{key:`${o}-${r}`,class:"fts-option-item inline-flex items-center gap-2 px-2 py-1 border rounded"},[t("span",null,O(o),1),t("button",{class:"text-xs",type:"button",onClick:s=>W(r)},"x",8,_e)]))),128))])])]),t("div",Te,[t("div",xe,[n[8]||(n[8]=t("label",{class:"block"},"Rides Columns",-1)),t("div",Ce,[(c(),d(x,null,C(N,o=>t("label",{key:o.key,class:"flex items-center gap-2"},[T(t("input",{type:"checkbox","onUpdate:modelValue":r=>g.value[o.key]=r},null,8,Oe),[[q,g.value[o.key]]]),t("span",null,O(o.label),1)])),64))])]),t("div",Ee,[n[9]||(n[9]=t("label",{class:"block"},"Routes Columns",-1)),t("div",Se,[(c(),d(x,null,C(V,o=>t("label",{key:o.key,class:"flex items-center gap-2"},[T(t("input",{type:"checkbox","onUpdate:modelValue":r=>y.value[o.key]=r},null,8,Re),[[q,y.value[o.key]]]),t("span",null,O(o.label),1)])),64))])])]),t("div",we,[t("button",{class:"fts px-3 py-1",disabled:k.value,onClick:P},"Save Configuration",8,he),t("button",{class:"fts-cfg-reset-button border px-3 py-1",type:"button",disabled:k.value,onClick:n[3]||(n[3]=o=>w.value=!0)},"Reset to Defaults",8,Le)])]),t("div",Ae,[t("button",{class:"fts px-3 py-1",disabled:k.value||A.value,onClick:ee},"Backup Data",8,Ue),n[10]||(n[10]=t("span",{class:"px-3 py-1"},"Make a backup of your data. This will download a SQL file containing all your rides, routes, and configuration.",-1))]),j(l,{show:w.value,title:"Reset Configuration",message:"Are you sure you want to reset configuration to defaults?",onConfirm:Z,onCancel:n[4]||(n[4]=o=>w.value=!1)},null,8,["show"]),j(v,{message:U.value},null,8,["message"])])}}});export{$e as default};
