import{_ as ie,a as oe}from"./B-jOZTf8.js";import{_ as re,a as ue}from"./Dh-7-jKO.js";import{_ as de}from"./DaMlzqSp.js";import{e as ce,f as pe,$ as y,h as ve,r,i as T,c as N,a as l,j as d,v as c,b as k,k as x,t as v,l as be,F as ge,m as fe,n as q,p as me,q as E,s as ye,o as I,x as ke,d as xe,y as we}from"./DIRT6zXZ.js";import{u as Se}from"./Cey6L-wt.js";import"./wJfVS7KU.js";const _e={class:"grid grid-cols-7 gap-4"},he={class:"col-span-1"},Ve={class:"col-span-2"},Ce={class:"col-span-1"},Ie={class:"col-span-1"},Le={class:"col-span-1"},De={class:"col-span-1"},ze={class:"col-span-2"},Ue={class:"col-span-1"},Re=["disabled"],Te={class:"col-span-3"},Ne={class:"col-span-1 flex items-end space-x-2"},Ee=["disabled"],Oe=["disabled"],Ae={class:"flex items-center justify-between mt-4 mb-4"},Ke={class:"flex items-center space-x-2"},$e=["disabled"],Be=["disabled"],Fe={class:"flex items-center space-x-2"},Pe={class:"relative z-20"},Je={key:0,class:"absolute right-0 mt-2 bg-white dark:bg-gray-800 border dark:border-gray-700 p-2 shadow z-30 w-max"},Me=["onUpdate:modelValue"],qe={class:"table-rides bg-white border overflow-x-auto relative"},Ge={class:"flex items-center justify-between mt-3"},je={class:"space-x-2"},He=["disabled"],Qe=["disabled"],at=ce({__name:"index",setup(We){const O=[{key:"id",label:"ID"},{key:"date",label:"Date"},{key:"description",label:"Description"},{key:"distance",label:"Distance"},{key:"average",label:"Average"},{key:"grade",label:"Grade"},{key:"bike",label:"Bike"},{key:"reference",label:"Reference"},{key:"link",label:"Link"},{key:"notes",label:"Notes"}],w=r(["Santos","Rimonta"]),S=r([5,10,20]),L=r([]),b=r(0),i=r([]),g=r(!1),D=r(!1),s=r({id:null,date:"",description:"",distance:null,average:null,grade:null,bike:"Santos",reference:"",link:"",notes:""}),u=r(""),_=r(!1),A={base:"border border-[var(--fts-ui-primary)] bg-[var(--fts-ui-bg-input-form)] text-[var(--fts-ui-primary)] rounded-[4px] min-h-[34px] px-2 py-1 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--fts-ui-button)] focus-visible:ring-inset"},K=O.reduce((t,e)=>(t[e.key]=!0,t),{});let $=null;async function h(t){const e=t||a.value,o=e.pagination?.pageIndex||0,p=e.pagination?.pageSize||10,U=e.globalFilter||"",V=e.sorting&&e.sorting[0]||null,R=V?.id||"date",n=V?.desc?"desc":"asc",m=new URLSearchParams({page:String(o),pageSize:String(p),filter:U,sortBy:R,sortDir:n});P(!0);try{const C=await y(`/api/rides?${m.toString()}`);L.value=C.rows||[],b.value=C.total||0}catch(C){u.value=C?.message||"Failed to load rides",setTimeout(()=>u.value="",3e3)}finally{P(!1)}}pe(async()=>{const t=localStorage.getItem("rides_column_visibility");if(t)try{const o=JSON.parse(t);o&&(a.value.columnVisibility=o)}catch{}const e=localStorage.getItem("rides_sorting");if(e)try{const o=JSON.parse(e);Array.isArray(o)&&(a.value.sorting=o)}catch{}try{const o=await y("/api/config");z(o)}catch{}typeof window<"u"&&(window.addEventListener("user-config-updated",B),window.addEventListener("storage",F)),h()}),ve(()=>{typeof window<"u"&&(window.removeEventListener("user-config-updated",B),window.removeEventListener("storage",F))});function z(t){t&&(Array.isArray(t.bikeOptions)&&t.bikeOptions.length&&(w.value=t.bikeOptions),Array.isArray(t.pageSizeOptions)&&t.pageSizeOptions.length&&(S.value=t.pageSizeOptions),w.value.includes(s.value.bike)||(s.value.bike=w.value[0]||""),S.value.includes(a.value.pagination.pageSize||10)||(a.value.pagination.pageSize=S.value[0]||10,a.value.pagination.pageIndex=0),t.ridesColumnVisibility&&(a.value.columnVisibility={...K,...t.ridesColumnVisibility},localStorage.setItem("rides_column_visibility",JSON.stringify(a.value.columnVisibility))))}function B(t){const e=t.detail;z(e)}function F(t){if(!(t.key!=="user_config"||!t.newValue))try{const e=JSON.parse(t.newValue);z(e)}catch{}}function G(t){clearTimeout($),$=setTimeout(()=>h(t),200)}const{loading:f,setLoading:P}=Se(),a=r({globalFilter:"",sorting:[{id:"date",desc:!0}],pagination:{pageIndex:0,pageSize:10},columnVisibility:K});T(()=>a.value.columnVisibility,t=>{typeof window>"u"||localStorage.setItem("rides_column_visibility",JSON.stringify(t))},{deep:!0}),T(()=>a.value.sorting,t=>{typeof window>"u"||localStorage.setItem("rides_sorting",JSON.stringify(t||[]))},{deep:!0}),T(a,t=>G(t),{deep:!0});const J=E(()=>(a.value.pagination?.pageIndex||0)*(a.value.pagination?.pageSize||10)),j=E(()=>Math.min(J.value+(a.value.pagination?.pageSize||10),b.value)),H=E(()=>[{accessorKey:"id",headerLabel:"ID",enableSorting:!0},{accessorKey:"date",headerLabel:"Date",enableSorting:!0},{accessorKey:"description",headerLabel:"Description",enableSorting:!0},{accessorKey:"distance",headerLabel:"Distance",enableSorting:!0},{accessorKey:"average",headerLabel:"Average",enableSorting:!0},{accessorKey:"grade",headerLabel:"Grade"},{accessorKey:"bike",headerLabel:"Bike",enableSorting:!0},{accessorKey:"reference",headerLabel:"Reference"},{accessorKey:"link",headerLabel:"Link",cell:t=>{const e=t.getValue();return t.row.original.reference?we("a",{href:t.row.original.reference,target:"_blank",class:"text-blue-600 hover:underline"},e||"Link"):e||""}},{accessorKey:"notes",headerLabel:"Notes"}]);function Q(t){a.value=typeof t=="function"?t(a.value):t}function W(){(a.value.pagination.pageIndex||0)>0&&a.value.pagination.pageIndex--}function X(){const t=a.value.pagination.pageIndex||0,e=a.value.pagination.pageSize||10;(t+1)*e<b.value&&a.value.pagination.pageIndex++}function Y(t){a.value.pagination.pageSize=t,a.value.pagination.pageIndex=0}function Z(t){i.value=t.map(e=>Number(e))}function ee(t,e){if(!t.ctrlKey&&!t.metaKey){const o=e?.id;i.value.includes(o)?i.value=[]:i.value=[o]}}function te(){if(i.value.length!==1)return;const t=i.value[0],e=L.value.find(p=>p.id===t);if(!e)return;g.value=!0;const o=e;s.value={...o},ye(()=>{document.querySelector("input[type=date]")?.focus()})}function le(){i.value.length!==0&&(_.value=!0)}async function ae(){if(i.value.length!==0)try{await Promise.all(i.value.map(t=>y(`/api/rides?id=${t}`,{method:"DELETE"}))),_.value=!1,u.value=`${i.value.length} ride${i.value.length>1?"s":""} deleted`,setTimeout(()=>u.value="",2500),i.value=[],h()}catch{u.value="Failed to delete rides",setTimeout(()=>u.value="",2500)}}function ne(){s.value.reference?s.value.link||(s.value.link="Link"):s.value.link=""}function M(){s.value={id:null,date:"",description:"",distance:null,average:null,grade:null,bike:"Santos",reference:"",link:"",notes:""},g.value=!1}async function se(){if(g.value)await y("/api/rides",{method:"PUT",body:s.value}),g.value=!1,selectedRow.value=null,u.value="Ride updated";else{const t={...s.value};t.reference&&!t.link&&(t.link="Link"),await y("/api/rides",{method:"POST",body:t}),u.value="Ride added"}setTimeout(()=>u.value="",2500),M(),h()}return(t,e)=>{const o=ie,p=re,U=ue,V=de,R=oe;return I(),N("section",null,[l("form",{onSubmit:be(se,["prevent"]),class:"fts p-6 mb-6 border-color rounded"},[e[23]||(e[23]=l("h1",{class:"text-3xl font-semibold mb-6"},"Add a Ride",-1)),l("div",_e,[l("div",he,[e[14]||(e[14]=l("label",{class:"block"},"Date*",-1)),d(l("input",{"onUpdate:modelValue":e[0]||(e[0]=n=>s.value.date=n),type:"date",required:"",class:"border px-2 py-1 w-full"},null,512),[[c,s.value.date]])]),l("div",Ve,[e[15]||(e[15]=l("label",{class:"block"},"Description*",-1)),d(l("input",{"onUpdate:modelValue":e[1]||(e[1]=n=>s.value.description=n),type:"text",required:"",class:"border px-2 py-1 w-full"},null,512),[[c,s.value.description]])]),l("div",Ce,[e[16]||(e[16]=l("label",{class:"block"},"Distance * (km)",-1)),d(l("input",{"onUpdate:modelValue":e[2]||(e[2]=n=>s.value.distance=n),type:"number",step:"0.1",required:"",class:"border px-2 py-1 w-full"},null,512),[[c,s.value.distance,void 0,{number:!0}]])]),l("div",Ie,[e[17]||(e[17]=l("label",{class:"block"},"Average (km/h)",-1)),d(l("input",{"onUpdate:modelValue":e[3]||(e[3]=n=>s.value.average=n),type:"number",step:"0.1",class:"border px-2 py-1 w-full"},null,512),[[c,s.value.average,void 0,{number:!0}]])]),l("div",Le,[e[18]||(e[18]=l("label",{class:"block"},"Grade (%)",-1)),d(l("input",{"onUpdate:modelValue":e[4]||(e[4]=n=>s.value.grade=n),type:"number",step:"0.1",class:"border px-2 py-1 w-full"},null,512),[[c,s.value.grade,void 0,{number:!0}]])]),l("div",De,[e[19]||(e[19]=l("label",{class:"block"},"Bike*",-1)),k(o,{modelValue:s.value.bike,"onUpdate:modelValue":e[5]||(e[5]=n=>s.value.bike=n),items:w.value,ui:A,class:"w-full",variant:"none"},null,8,["modelValue","items"])]),l("div",ze,[e[20]||(e[20]=l("label",{class:"block"},"Reference",-1)),d(l("input",{"onUpdate:modelValue":e[6]||(e[6]=n=>s.value.reference=n),type:"text",class:"border px-2 py-1 w-full",onInput:ne},null,544),[[c,s.value.reference]])]),l("div",Ue,[e[21]||(e[21]=l("label",{class:"block"},"Link",-1)),d(l("input",{"onUpdate:modelValue":e[7]||(e[7]=n=>s.value.link=n),disabled:!s.value.reference,type:"text",class:"border px-2 py-1 w-full"},null,8,Re),[[c,s.value.link]])]),l("div",Te,[e[22]||(e[22]=l("label",{class:"block"},"Notes",-1)),d(l("input",{"onUpdate:modelValue":e[8]||(e[8]=n=>s.value.notes=n),type:"text",class:"border px-2 py-1 w-full"},null,512),[[c,s.value.notes]])]),l("div",Ne,[l("button",{type:"submit",class:"fts px-3 py-1",disabled:x(f)},v(g.value?"Update":"Add"),9,Ee),l("button",{type:"button",onClick:M,class:"fts px-3 py-1",disabled:x(f)},"Clear",8,Oe)])])],32),k(p,{show:_.value,title:"Delete Ride",message:`Are you sure you want to delete ${i.value.length} ride${i.value.length>1?"s":""}?`,onConfirm:ae,onCancel:e[9]||(e[9]=()=>_.value=!1)},null,8,["show","message"]),k(U,{message:u.value},null,8,["message"]),e[24]||(e[24]=l("h1",{class:"text-3xl font-semibold mb-6 mt-10"},"Completed Rides",-1)),l("div",Ae,[l("div",Ke,[l("button",{class:"px-3 py-1 fts disabled:opacity-50",disabled:i.value.length!==1||x(f),onClick:te},"Edit",8,$e),l("button",{class:"px-3 py-1 fts-delete disabled:opacity-50",disabled:i.value.length===0||x(f),onClick:le},"Delete "+v(i.value.length>1?`(${i.value.length})`:""),9,Be)]),l("div",Fe,[d(l("input",{"onUpdate:modelValue":e[10]||(e[10]=n=>a.value.globalFilter=n),placeholder:"Search",class:"border px-2 py-1"},null,512),[[c,a.value.globalFilter]]),k(o,{modelValue:a.value.pagination.pageSize,"onUpdate:modelValue":[e[11]||(e[11]=n=>a.value.pagination.pageSize=n),e[12]||(e[12]=n=>Y(n))],items:S.value,ui:A,class:"w-24",variant:"none"},null,8,["modelValue","items"]),l("div",Pe,[l("button",{onClick:e[13]||(e[13]=n=>D.value=!D.value),class:"border px-2 py-1"},"Columns â–¾"),D.value?(I(),N("div",Je,[(I(),N(ge,null,fe(O,n=>l("label",{key:n.key,class:"block dark:text-white"},[d(l("input",{type:"checkbox","onUpdate:modelValue":m=>a.value.columnVisibility[n.key]=m},null,8,Me),[[ke,a.value.columnVisibility[n.key]]]),xe(" "+v(n.label),1)])),64))])):q("",!0)])])]),l("div",qe,[k(V,{data:L.value,columns:H.value,state:a.value,multiSelect:!0,selectedRowIds:i.value,onSelectionChange:Z,onStateChange:Q,onSelect:(n,m)=>ee(n,m)},null,8,["data","columns","state","selectedRowIds","onSelect"]),x(f)?(I(),me(R,{key:0})):q("",!0)]),l("div",Ge,[l("div",null,"Showing "+v(J.value+1)+" - "+v(j.value)+" of "+v(b.value),1),l("div",je,[l("button",{onClick:W,disabled:(a.value.pagination.pageIndex||0)===0,class:"px-2 py-1 border"},"Prev",8,He),l("button",{onClick:X,disabled:((a.value.pagination.pageIndex||0)+1)*(a.value.pagination.pageSize||10)>=b.value,class:"px-2 py-1 border"},"Next",8,Qe)])])])}}});export{at as default};
